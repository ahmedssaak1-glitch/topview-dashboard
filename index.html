<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Top View â€” System</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--accent:#1f78ff;--muted:#6b7280;--bg:#f6f7fb;--card:#fff;--radius:12px}
  *{box-sizing:border-box} body{font-family:Inter,system-ui,Arial;margin:0;background:var(--bg);color:#0f172a}
  .hero{min-height:100vh;display:flex;align-items:center;justify-content:center;background-image:url('https://images.unsplash.com/photo-1512453979798-5ea266f8880c?auto=format&fit=crop&w=1600&q=80');background-size:cover;background-position:center;position:relative}
  .overlay{position:absolute;inset:0;background:rgba(0,0,0,0.45)}
  .card{position:relative;z-index:2;background:rgba(255,255,255,0.95);padding:28px;border-radius:14px;width:100%;max-width:420px;box-shadow:0 10px 30px rgba(2,6,23,0.12);text-align:left}
  .logo{font-weight:800;color:var(--accent);font-size:20px;margin-bottom:6px}
  input{width:100%;padding:12px;border-radius:10px;border:1px solid #e6e9ef;margin:8px 0;font-size:15px}
  button{padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;cursor:pointer}
</style>
</head>
<body>
<div id="root"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCEpRw7F829fqzPZAphqJ2wOe3xUDJWLtw",
  authDomain: "topview-system.firebaseapp.com",
  projectId: "topview-system",
  storageBucket: "topview-system.appspot.com",
  messagingSenderId: "1073945877413",
  appId: "1:1073945877413:web:d516e451e543f7a9db664c",
  measurementId: "G-EPVZGH6Y2G"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);

const root = document.getElementById('root');
function el(tag, attrs={}, ...kids){
  const n=document.createElement(tag);
  for(const k in attrs){
    if(k==='class') n.className=attrs[k];
    else n.setAttribute(k,attrs[k]);
  }
  kids.forEach(c=> typeof c==='string'? n.appendChild(document.createTextNode(c)) : n.appendChild(c));
  return n;
}

// Create demo users
async function createDemoUsers(){
  const demoUsers = [
    {username:'m.fouad', name:'Mohamed Fouad', email:'m.fouad@topview.local', password:'pass123'},
    {username:'m.salah', name:'Mohamed Salah', email:'m.salah@topview.local', password:'pass123'},
    {username:'ibrahim', name:'Ibrahim', email:'ibrahim@topview.local', password:'pass123'}
  ];
  for(const u of demoUsers){
    try{
      await createUserWithEmailAndPassword(auth,u.email,u.password);
      await addDoc(collection(db,'users'),{username:u.username,name:u.name,email:u.email});
    }catch(e){ console.warn('User exists or error:', e.message); }
  }
  alert('Demo accounts created. Emails/password: m.fouad@topview.local / pass123, m.salah@topview.local / pass123, ibrahim@topview.local / pass123');
}

// Login UI
function showLogin(){
  root.innerHTML='';
  const hero = el('div',{class:'hero'});
  hero.appendChild(el('div',{class:'overlay'}));
  const card = el('div',{class:'card'});
  card.appendChild(el('div',{class:'logo'}, 'Top View'));
  const email = el('input',{type:'email', placeholder:'Email'});
  const pass = el('input',{type:'password', placeholder:'Password'});
  const btnLogin = el('button',{}, 'Login');
  btnLogin.onclick = async ()=>{
    try{
      await signInWithEmailAndPassword(auth,email.value.trim(),pass.value);
    }catch(err){ alert('Login failed: '+err.message); }
  };
  const btnDemo = el('button',{style:'margin-left:8px;background:#e6eefc;color:var(--accent)'}, 'Create demo accounts');
  btnDemo.onclick = createDemoUsers;
  card.appendChild(email);
  card.appendChild(pass);
  card.appendChild(el('div',{style:'display:flex;gap:8px;margin-top:8px'}, btnLogin, btnDemo));
  hero.appendChild(card);
  root.appendChild(hero);
}

onAuthStateChanged(auth,user=>{
  if(user){
    root.innerHTML='';
    root.appendChild(el('h2',{},'Welcome, '+user.email));
  }else{
    showLogin();
  }
});
</script>
</body>
</html>
