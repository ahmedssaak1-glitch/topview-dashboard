<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Top View — System</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--accent:#1f78ff;--muted:#6b7280;--bg:#f6f7fb;--card:#fff;--radius:12px}
    *{box-sizing:border-box} body{font-family:Inter,system-ui,Arial;margin:0;background:var(--bg);color:#0f172a}
    .hero{min-height:100vh;display:flex;align-items:center;justify-content:center;background-image:url('https://images.unsplash.com/photo-1512453979798-5ea266f8880c?auto=format&fit=crop&w=1600&q=80');background-size:cover;background-position:center;position:relative}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,0.45)}
    .card{position:relative;z-index:2;background:rgba(255,255,255,0.95);padding:28px;border-radius:14px;width:100%;max-width:420px;box-shadow:0 10px 30px rgba(2,6,23,0.12);text-align:left}
    .logo{font-weight:800;color:var(--accent);font-size:20px;margin-bottom:6px}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid #e6e9ef;margin:8px 0;font-size:15px}
    button{padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;cursor:pointer}
    .app{display:flex;min-height:100vh}
    .sidebar{width:260px;background:linear-gradient(180deg,#fff,#fbfcff);border-right:1px solid #eef2f7;padding:18px;display:flex;flex-direction:column;gap:12px}
    .main{flex:1;padding:20px}
    .nav button{display:block;padding:10px;border-radius:8px;border:0;background:transparent;text-align:left;width:100%;cursor:pointer}
    .nav button.active{background:#f1f6ff;color:var(--accent);font-weight:700}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:14px}
    .stat{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 6px 20px rgba(2,6,23,0.04)}
    table{width:100%;border-collapse:collapse;background:var(--card);border-radius:8px;overflow:hidden}
    th,td{padding:10px 12px;border-bottom:1px solid #f3f6fa;text-align:left}
    th{background:#fafbff;color:var(--muted);font-weight:700}
    .small{font-size:13px;color:var(--muted)}
    @media(max-width:900px){.sidebar{display:none}.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:600px){.grid{grid-template-columns:1fr}.card{max-width:340px}}
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Firebase SDKs (Modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getStorage } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCEpRw7F829fqzPZAphqJ2wOe3xUDJWLtw",
      authDomain: "topview-system.firebaseapp.com",
      projectId: "topview-system",
      storageBucket: "topview-system.appspot.com",
      messagingSenderId: "1073945877413",
      appId: "1:1073945877413:web:d516e451e543f7a9db664c",
      measurementId: "G-EPVZGH6Y2G"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const root = document.getElementById('root');
    function el(tag, attrs={}, ...kids){ 
      const n=document.createElement(tag); 
      for(const k in attrs){ 
        if(k==='class') n.className=attrs[k]; 
        else n.setAttribute(k,attrs[k]); 
      } 
      kids.forEach(c=> typeof c==='string' ? n.appendChild(document.createTextNode(c)) : n.appendChild(c)); 
      return n; 
    }

    // Demo: create initial users
    async function seedDemoData(){
      const usersRef = collection(db,'users');
      const usersSnap = await getDocs(usersRef);
      if(!usersSnap.empty) return;
      const demoUsers = [
        {username:'m.fouad', name:'Mohamed Fouad', role:'Manager', salary:15000, email:'m.fouad@topview.local'},
        {username:'m.salah', name:'Mohamed Salah', role:'Supervisor', salary:8000, email:'m.salah@topview.local'},
        {username:'ibrahim', name:'Ibrahim', role:'Worker', salary:3500, email:'ibrahim@topview.local'}
      ];
      for(const u of demoUsers){
        await addDoc(usersRef,u);
        try{ await createUserWithEmailAndPassword(auth,u.email,'pass123'); } catch(e){ }
      }
      await addDoc(collection(db,'projects'),{name:'Apartment 12B Fitout', client:'Mr. Hassan', status:'In Progress', budget:45000, engineer:'Mohamed Salah'});
      await addDoc(collection(db,'transactions'),{type:'Expense', category:'Materials', amount:12000, date:new Date().toISOString().slice(0,10), note:'Tiles+adhesives'});
      console.log('Seeded demo data');
    }

    // Login UI
    function showLogin(){
      root.innerHTML = '';
      const hero = el('div',{class:'hero'});
      hero.appendChild(el('div',{class:'overlay'}));
      const card = el('div',{class:'card'});
      card.appendChild(el('div',{class:'logo'}, 'Top View'));
      card.appendChild(el('div',{class:'small'}, 'Top View — Interior Fit-out'));
      card.appendChild(el('hr'));
      const email = el('input',{type:'email', placeholder:'Email'});
      const pass = el('input',{type:'password', placeholder:'Password'});
      const btn = el('button',{}, 'Login');
      btn.onclick = async ()=>{
        try{
          await signInWithEmailAndPassword(auth,email.value.trim(),pass.value);
        }catch(err){ alert('Login failed: '+err.message); }
      };
      const signup = el('button',{style:'margin-left:8px;background:#e6eefc;color:var(--accent)'},'Create demo accounts');
      signup.onclick = async ()=>{ await seedDemoData(); alert('Demo users created. Emails: m.fouad@topview.local, m.salah@topview.local, ibrahim@topview.local / pass123'); };
      card.appendChild(email); card.appendChild(pass); card.appendChild(el('div',{style:'display:flex;gap:8px;margin-top:8px'}, btn, signup));
      card.appendChild(el('p',{class:'small'},'If you used previous demo: Manager = m.fouad@topview.local / pass123'));
      hero.appendChild(card);
      root.appendChild(hero);
    }

    onAuthStateChanged(auth,user=>{
      if(user) renderApp(user);
      else showLogin();
    });

    // هنا ممكن نكمل كل باقي الـ CRUD والـ UI بنفس طريقة الكود القديم لكن مع modular imports
  </script>
</body>
</html>
