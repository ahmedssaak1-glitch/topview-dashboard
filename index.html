<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TopView — Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f4f6fa;
      margin: 0;
      color: #222;
    }
    .login-bg {
      background: url('https://images.unsplash.com/photo-1508120272534-9e2d58b7d1f2?auto=format&fit=crop&w=1400&q=80') center/cover no-repeat;
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      filter: brightness(0.5);
      z-index: -1;
    }
    .login-box {
      max-width: 340px;
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      margin: 120px auto;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    h2 { text-align: center; }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      margin-bottom: 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }
    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      font-size: 15px;
    }
    button:hover { background: #0056b3; }
    .sidebar {
      width: 220px;
      background: #fff;
      height: 100vh;
      position: fixed;
      border-right: 1px solid #ddd;
      padding-top: 20px;
    }
    .sidebar h3 { text-align: center; color: #007bff; margin-bottom: 20px; }
    .sidebar button {
      width: 90%;
      margin: 6px auto;
      display: block;
      background: none;
      color: #222;
      text-align: left;
      padding: 10px 12px;
      border-radius: 8px;
      transition: 0.2s;
    }
    .sidebar button.active, .sidebar button:hover {
      background: #007bff; color: #fff;
    }
    main {
      margin-left: 240px;
      padding: 20px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    th { text-align: left; background: #f9fafb; }
    tr:hover td { background: #f1f5ff; }
    .btn { background: #007bff; color: #fff; padding: 8px 14px; border-radius: 8px; border: none; cursor: pointer; }
    .btn:hover { background: #0056b3; }
    .btn.ghost { background: #eee; color: #333; }
  </style>
</head>
<body>
  <div id="app"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
  // Firebase Config (من عندك)
  const firebaseConfig = {
    apiKey: "AIzaSyCEpRw7F829fqzPZAphqJ2wOe3xUDJWLtw",
    authDomain: "topview-system.firebaseapp.com",
    projectId: "topview-system",
    storageBucket: "topview-system.firebasestorage.app",
    messagingSenderId: "1073945877413",
    appId: "1:1073945877413:web:d516e451e543f7a9db664c",
    measurementId: "G-EPVZGH6Y2G"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // الحالة العامة
  const state = { user: null, page: 'Clients', clients: [] };
  const app = document.getElementById('app');

  // دالة مساعدة لعمل عناصر بسرعة
  function el(tag, attrs={}, ...children){
    const e = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)){
      if(k.startsWith('on')) e.addEventListener(k.substring(2), v);
      else e.setAttribute(k, v);
    }
    for (const c of children){
      if(typeof c === 'string') e.appendChild(document.createTextNode(c));
      else if(c) e.appendChild(c);
    }
    return e;
  }

  // تسجيل الدخول
  function renderLogin(){
    app.innerHTML = '';
    const bg = el('div',{class:'login-bg'});
    const box = el('div',{class:'login-box'},
      el('h2',{},'TopView interior decoration'),
      el('input',{id:'email',type:'email',placeholder:'Email'}),
      el('input',{id:'password',type:'password',placeholder:'Password'}),
      el('button',{onclick:login},'Login')
    );
    app.append(bg,box);
  }

  function login(){
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    if(email==='admin@topview.com' && password==='123456'){
      state.user = { name:'Admin' };
      loadClients();
      renderDashboard();
    }else{
      alert('Invalid credentials');
    }
  }

  // الواجهة الرئيسية
  function renderDashboard(){
    app.innerHTML = '';
    const sidebar = el('div',{class:'sidebar'},
      el('h3',{},'TopView'),
      el('button',{class: state.page==='Clients'?'active':'', onclick:()=>switchPage('Clients')},'Clients'),
      el('button',{onclick:()=>logout()},'Logout')
    );
    const main = el('main');
    if(state.page==='Clients') main.appendChild(buildClientsTable());
    app.append(sidebar,main);
  }

  function switchPage(p){ state.page=p; renderDashboard(); }
  function logout(){ state.user=null; renderLogin(); }

  // تحميل العملاء من Firestore
  function loadClients(){
    db.collection('clients').onSnapshot(s=>{
      state.clients = s.docs.map(d=>({id:d.id, ...d.data()}));
      if(state.user) renderDashboard();
    });
  }

  // إضافة عميل
  async function openAddClient(){
    const name = prompt('Client name:');
    if(!name) return;
    const phone = prompt('Phone (optional):');
    const project = prompt('Project (optional):');
    const status = prompt('Status (Lead / Active / Completed):','Lead');
    await db.collection('clients').add({ name, phone, project, status, createdAt:new Date().toISOString() });
    alert('Client added!');
  }

  // جدول العملاء
  function buildClientsTable(){
    const wrap = el('div',{class:'card'});
    wrap.appendChild(el('div',{style:'display:flex;justify-content:space-between;align-items:center;margin-bottom:8px'},
      el('h3',{},'Clients'),
      el('button',{class:'btn',onclick:openAddClient},'Add Client')
    ));
    const table = el('table');
    const thead = el('thead',{}, el('tr',{},
      el('th',{},'Name'),
      el('th',{},'Phone'),
      el('th',{},'Project'),
      el('th',{},'Status'),
      el('th',{},'Actions')
    ));
    const tbody = el('tbody');
    state.clients.forEach(c=>{
      const tr = el('tr',{},
        el('td',{},editableCell(c,'name')),
        el('td',{},editableCell(c,'phone')),
        el('td',{},editableCell(c,'project')),
        el('td',{},editableCell(c,'status')),
        el('td',{},deleteBtn(c.id))
      );
      tbody.appendChild(tr);
    });
    table.append(thead,tbody);
    wrap.appendChild(table);
    return wrap;
  }

  // خلية قابلة للتعديل
  function editableCell(client,field){
    const d = el('div',{contenteditable:true,style:'outline:none;min-width:100px;'}, client[field]||'');
    d.addEventListener('blur', async ()=>{
      const val = d.textContent.trim();
      await db.collection('clients').doc(client.id).update({ [field]: val });
      d.style.background='#e6ffe6';
      setTimeout(()=>d.style.background='transparent',400);
    });
    d.addEventListener('keydown',(e)=>{if(e.key==='Enter'){e.preventDefault();d.blur();}});
    return d;
  }

  function deleteBtn(id){
    const b = el('button',{class:'btn ghost'},'Delete');
    b.onclick = async ()=>{
      if(confirm('Delete this client?')){
        await db.collection('clients').doc(id).delete();
      }
    };
    return b;
  }

  // تشغيل أولي
  renderLogin();
  </script>
</body>
</html>
